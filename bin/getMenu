#!/usr/bin/env node

var http = require("http");
var cheerio = require("cheerio");
var _ = require('underscore');

if (process.argv.length < 3) {
  console.error("Please provide a restaurant name");
  process.exit(1);
}

var url ="http://sanfrancisco.menupages.com/restaurants/" + process.argv[2] + "/menu";

var ignoredWords = [
  '&',
  'a',
  'and',
  'half',
  'in',
  'of',
  'on',
  'one',
  'three',
  'two',
  'with',
  //"stewed", 
  //"fried", 
  //"fry",
  //"saute",
  //"grilled", 
  //"baked", 
  //"seared",
  //"boiled", 
  //"pan-fried",
  //"roasted", 
  //"steamed", 
  //"poached", 
  //"fresh", 
  //"curried", 
  //"barecue", 
  "toasted",
  //"stir-fried", 
  "cooked",
  "served",
  "paper",
  "tossed",
  "topped"
];

var getMenu = function(html) {
  var $ = cheerio.load(html);
  var menu = {};
  $("cite").each(function(){
    var name = this.text()
      .replace(/^\d+[.:)]? */, ''); //name
    var allWords = this.parent().text() //ingredients
      .replace(/^\s*\d+[.:)]? */, '')
      .toLowerCase()
      .replace(/[.:\d]/g, '')
      .replace(/\(.*\)/g, '')
      .trim()
      .split(/[, \u00A0]+/)
      .map(function(word) {
        return word.replace(/^[^a-z]+|[^a-z]+$/g, '');
      })
    menu[name] = _.reject(allWords, function(word) {
      return _.contains(ignoredWords, word) || /\d/.test(word) || /^[^a-z]*$/i.test(word);
    });
  }) 
  return menu; 
};

http.get(url, function(res) {
  var data = '';
  res.setEncoding('utf8');
  res.on('data', function(chunk) {
    data += chunk;
  });
  res.on('end', function() {
    console.log(JSON.stringify(getMenu(data), null, 2));
  });
}).on('error', function(err) {
  console.log("Got error: " + err.message);
});

[ ' blueberry',
  'King California',
  'New Zealand Roll',
  'Organic Sliced Sourdoug Bread',
  'Pain De Mie Sandwich Bread',
  'Plain Pain De Mie Hamburger Bun',
  'Sliced Whole Wheat Bread',
  'absolute vodka',
  'alaskan roll',
  'allagash triple ale',
  'almond biscotti',
  'amber ale',
  'anchor brewery ale',
  'anchor steam',
  'angostura bitters',
  'angry orchard apple cider',
  'angus sirloin',
  'angus steak',
  'anti-biotic free beef',
  'apple turnover',
  'artichoke hearts',
  'australian rack lamb',
  'baby bok choy',
  'baby carrots',
  'baby cns',
  'baby corn',
  'bacardi rum',
  'balsamic vinegar',
  'bamboo shoot',
  'bamboo shoots',
  'banana leaf',
  'barbecued chicken',
  'basil-chili jam',
  'basmati rice',
  'batter-fried sweet onion',
  'bbq beef',
  'bbq chicken',
  'bbq meatless chicken',
  'bbq pork',
  'bbq pork spareribs',
  'bean curd',
  'bean sprout',
  'bean sprouts',
  'bean thread noodles',
  'bear republic ale',
  'bechamel sauce',
  'beef ball',
  'beef satay',
  'beef stew',
  'beet juice',
  'beet loaf',
  'belgian style golden ale',
  'bell pepper',
  'bell peppers',
  'beringer gewurztraminer, california',
  'beringer third century pinot noir, central coast',
  'black bean chili sauce',
  'black bean sauce',
  'black forest ham',
  'black fungus mushroom',
  'black mission fig',
  'black mushroom',
  'black olives',
  'black pepper',
  'black peppers',
  'black tea',
  'blanco cassis',
  'blue cheese',
  'blue cheese cheese',
  'bok choy',
  'bombay sapphire',
  'bone-less beef short ribs',
  'boneless organic chicken',
  'braised fish',
  'brioche loaf',
  'brown rice',
  'brussel sprouts',
  'butternut squash',
  'caesar dressing',
  'cage-free eggs',
  'california roll',
  'candied pecans',
  'caprese salad',
  'caramelized onions',
  'caramelized red onions',
  'caramelized yellow onions',
  'carmelized onion',
  'carmelized onions',
  'cashew nut',
  'cashew nuts',
  'celery root remoulade',
  'charbroiled atlantic salmon',
  'charcoal prawns',
  'cheese baguette',
  'cheese danish',
  'cherry tomato',
  'cherry tomatoes',
  'chicken breast',
  'chicken roasted',
  'chicken rolls',
  'chicken satay',
  'chicken tenderloins',
  'chicken wing',
  'chicken wings',
  'chile pepper',
  'chili jam',
  'chili peppers',
  'chili sauce',
  'chili-garlic sauce',
  'chili-lime sauce',
  'chinese broccoli',
  'chocolate biscotti',
  'chocolate chip',
  'chocolate panna cotta',
  'chow Mein',
  'chow fun',
  'chow fun noodle',
  'chow mein',
  'chow mein noodle',
  'cht st jean fume blanc, sonoma',
  'cilantro-mint chutney',
  'cinnamon twists',
  'clay pot',
  'clos du bois chardonnay, sonoma',
  'cocchi americano',
  'cocoa nibs',
  'coconut curry sauce',
  'coconut custard',
  'coconut dressing',
  'coconut milk',
  'coconut-habanero chutney',
  'cold noodle',
  'coppola diamond sauvignon blanc napa',
  'crab cake',
  'crab cakes',
  'crab meat',
  'crab puff',
  'cranberry juice',
  'creamy spiced potatoes',
  'crispy catfish',
  'crispy chicken',
  'crispy duck',
  'crispy meatless chicken',
  'crispy meatless fish',
  'crispy pork',
  'crispy pork belly',
  'crispy samosas',
  'crispy sea bass',
  'crispy soft tofu',
  'crispy tiger prawns',
  'crispy vegetable roll',
  'croque monsieur',
  'croquet bordelaise',
  'crunchy beancakes',
  'crushed peanuts',
  'crème fraiche',
  'crème fraîche',
  'cuban beef',
  'cucumber salad',
  'cumin auce',
  'cumin sauce',
  'cumin soup',
  'curly endive',
  'curried nectar',
  'curried-peanut dressing',
  'curried-peanut sauce',
  'curry auce',
  'curry chicken',
  'curry leaf',
  'curry leaves',
  'curry paste',
  'curry prawns',
  'curry puff',
  'deep fried prawns',
  'deep fried rice balls',
  'deep fried rolls',
  'deep fried tofu',
  'depth charge',
  'diced potatoes',
  'dijon sauce',
  'doga clavule morellino',
  'dosa rolled',
  'draft beer',
  'dried chili',
  'dried chili flakes',
  'dried fungus',
  'dried shrimps',
  'dry red curry',
  'dry red curry sauce',
  'dungeness crab',
  'durum wheat',
  'egg custard',
  'egg noodles',
  'egg roll',
  'egg rolls',
  'eggplant chutney',
  'estaminet pilsner',
  'fat tire',
  'fennel spinach dosa',
  'filled dosa',
  'fish ball',
  'fish cake',
  'fish filet',
  'fish fillet',
  'fish of the day',
  'five spice',
  'five spices',
  'five spices spice',
  'flax seed',
  'fountain soda',
  'free-range chicken',
  'free-range lamb',
  'french press coffee',
  'fresh coconut',
  'fresh spring rolls',
  'fried Rice',
  'fried egg',
  'fried mint raita',
  'fried prawns',
  'fried rice',
  'fried rice stick noodles',
  'fried stems',
  'fried tofu',
  'fruit danish',
  'fruit danishes',
  'fuller’s ale',
  'garlic bread',
  'garlic chili sauce',
  'garlic chutney',
  'garlic sauce',
  'ginger ale',
  'ginger beer',
  'ginger sauce',
  'goat cheese',
  'goat cheese cheese',
  'golden bean cakes',
  'golden pouches',
  'gorgonzola cheese',
  'gravy sauce',
  'green beans',
  'green bell peppers',
  'green chiles',
  'green curry',
  'green mango',
  'green olives',
  'green papaya',
  'green papaya salad',
  'green tea',
  'green tea liqueur',
  'gribiche vinaigrette',
  'grilled beef',
  'grilled cheese',
  'grilled chicken',
  'grilled chicken breast',
  'grilled peas',
  'grilled prawns',
  'grilled shrimp',
  'ground chicken',
  'ground chiles',
  'ground lentils',
  'ground peanut',
  'ground pork',
  'habanero chutney',
  'habanero-mango chutney',
  'habañero chiles',
  'hama-masa roll',
  'hard-boiled egg',
  'hardboiled egg',
  'heirloom potatoes',
  'herb pain de mie hamburger bun',
  'herb sauce',
  'herbed goat cheese cheese',
  'herbs de provence',
  'hoisin sauce',
  'hot and sour',
  'hot and sour sauce',
  'hot chili paste',
  'hot chocolate',
  'hot peppers',
  'hot sour soup',
  'house coffee',
  'housemade bread',
  'hunan sauce',
  'ice cream',
  'iced tea',
  'imitation crab',
  'imperial roll',
  'imperial rolls',
  'india beer',
  'indian bread',
  'indian spices',
  'italian soda',
  'jalapeno chiles',
  'japanese eggplant',
  'japanese pumpkin',
  'japanese scallops',
  'jasmine rice',
  'juice squeeze',
  'jumbo prawns',
  'kabocha pumpkin',
  'kabocha quash',
  'kikkoman plum',
  'kingfisher lager',
  'kung pao sauce',
  'la terre chardoey',
  'la terre merlot, california',
  'lamb chops',
  'lemon chicken',
  'lemon juice',
  'lemon peppercorn dressing',
  'lemon sauce',
  'lemon turnover',
  'lemon vinaigrette',
  'lemongrass cream dressing',
  'lemongrass-chili sauce',
  'lentil dipping soup',
  'lentil dumplings',
  'lettuce cup',
  'lime juice',
  'lime wedges',
  'lime zest',
  'lo mein noodle',
  'lockwood syrah, monterey',
  'louisiana shrimp',
  'low fat milk',
  'lychee puree',
  'maine lobster',
  'maitake mushrooms',
  'mandarin sauce',
  'mango pudding',
  'mango puree',
  'maple syrup',
  'marinated chiles',
  'marinated skirt steak',
  'masala sauce',
  'mashed potatoes',
  'meat ball',
  'meatles chicken',
  'meatless beef',
  'meatless chicken',
  'meatless fish',
  'meatless ham',
  'michette bun',
  'mild curry',
  'mild yellow curry',
  'mildly spiced',
  'minced chicken',
  'minced chicken breast',
  'minced lamb',
  'minced pork',
  'mini ficelle',
  'mini uttapams',
  'mint leaves',
  'mint-cilantro sauce',
  'mint-cilantro water',
  'mixed vegetable',
  'mixed vegetable soup',
  'mixed vegetables',
  'mixed vegetarianetables',
  'mongolian lamb',
  'mongolian sauce',
  'moon cake',
  'mu shu',
  'mung bean',
  'mung lentil',
  'mung sprouts',
  'mushroom sauce',
  'mustard seeds',
  'napa cabbage',
  'nigiri sushi',
  'nigori sake',
  'olive oil',
  'olive roll',
  'on the rocks',
  'onion sweet',
  'open-faced pancake-style dosa',
  'orange blossom',
  'orange juice',
  'orange lamb',
  'orange sauce',
  'organic mixed greens',
  'organic seasonal micro greens',
  'organic spinach',
  'organic tea',
  'over easy',
  'oyster mushrooms',
  'oyster sauce',
  'pain de mie',
  'pale ale',
  'pale lager',
  'palm belgian ale',
  'pan fried',
  'pan fried bread',
  'pana cotta',
  'paper thin dosa',
  'pea sprout',
  'peach bun',
  'peanut sauce',
  'peasant bread',
  'penne pasta',
  'petit palmiers',
  'pickled mustard',
  'pimm’s gin',
  'pine nut',
  'pinot bianco',
  'pinot gris',
  'plain challah',
  'plum bitters',
  'poached chicken breast',
  'pomegranate seeds',
  'pommes frites',
  'pork ball',
  'pork chop',
  'pork shoulder',
  'portabella mushroom',
  'portobello mushroom',
  'pot sticker',
  'pot stickers',
  'pound cake',
  'prawn masala',
  'prawns tiger',
  'premium lager',
  'puff pastry',
  'puffed rice',
  'puffy round fried bread',
  'pâte sucrée',
  'raspberry financiers',
  'red bell peppers',
  'red chiles',
  'red chili oil',
  'red curry',
  'red fruit',
  'red onion',
  'red onions',
  'red peppers',
  'red wine',
  'red wine sauce',
  'reduction coconut milk',
  'rice crepe',
  'rice noodle',
  'rice noodle soup',
  'rice noodles',
  'rice powder',
  'rice stick noodles',
  'roasted chicken',
  'roasted chile',
  'roasted chili',
  'roasted chili dressing',
  'roasted chili paste',
  'roasted duck',
  'roasted pork',
  'roasted puréed red beets',
  'roasted red pepper',
  'roasted red peppers',
  'roasted rice powder',
  'rockstar energyd drink',
  'roma tomato',
  'roma tomatoine',
  'rose water',
  'rose wine',
  'russian tea cookies',
  'rye whiskey',
  'saint m riesling',
  'salad green beanss',
  'salad greens',
  'salad sgreens',
  'salted caramel sauce',
  'samuel adams',
  'satay beef',
  'satay sauce',
  'sauteed chicken',
  'sauteed prawns',
  'sauteed scallop',
  'sauteed string bean',
  'sauvignon blanc',
  'scrambled eggs',
  'sea bass',
  'seasonal  chicories',
  'seasonal chicories',
  'seasonal greens',
  'seasonal peppers',
  'serrano chiles',
  'sesame ball',
  'sesame sauce',
  'shish kebab',
  'shitake mushroom',
  'shredde pork',
  'shredded coconut',
  'shredded duck',
  'shredded mango',
  'shredded pork',
  'sierra nevada',
  'silver noodles',
  'siu mai',
  'sizzling hot pot',
  'sizzling rice',
  'sizzling skirt steak',
  'skirt steak',
  'sliced 8 grain bread',
  'sliced bananas',
  'sliced beef',
  'sliced boneless roasted duck',
  'sliced chicken',
  'sliced roasted pork',
  'sliced tomatoes',
  'small hollow crispy breads',
  'smoked pork',
  'smoked salmon',
  'smoked trout',
  'smoked turkey',
  'snake beans',
  'snap peas',
  'snow peas',
  'soft puffy wheat bread',
  'soft shell crab',
  'soft tofu',
  'sour green mango',
  'sour sauce',
  'sourdough croutons',
  'soy bean',
  'soy bean sauce',
  'soybean sauce',
  'spare rib',
  'sparkling soda',
  'sparkling white wine',
  'sparkling wine',
  'spiced agave',
  'spiced agave nectar',
  'spiced corn fritters',
  'spiced farmer’s cheese',
  'spiced fish cakes',
  'spiced ground lamb',
  'spiced mango',
  'spiced mango nectar',
  'spiced potatoes',
  'spiced yogurt',
  'spiced-potato patty',
  'spicy and sour soup',
  'spicy broth',
  'spicy chutney',
  'spicy cumin sauce',
  'spicy cumino sauce',
  'spicy lime dressing',
  'spicy mint',
  'spicy sour orange curry',
  'spring onions',
  'sprouted mung lentils',
  'sriracha chili vinaigrette',
  'st bernardus ale',
  'st laurent',
  'star anise',
  'steamed rice',
  'steamed rice patties',
  'steamed rice vermicelli noodle',
  'sticky bun',
  'sticky buns',
  'sticky rice',
  'straus organic yogurt',
  'string bean',
  'string beans',
  'stuffed crab',
  'stuffed eggplant',
  'stuffed mushroom',
  'sugar cube',
  'sujata house red',
  'sunny side up',
  'sustainably-caught fish',
  'sweet and sour',
  'sweet and sour sauce',
  'sweet cheese patties',
  'sweet chili sauce',
  'sweet chili vinaigrette',
  'sweet cilantro dressing',
  'sweet curry',
  'sweet onion',
  'sweet peppers',
  'sweet potato',
  'sweet rice',
  'sweet sticky rice',
  'sweet tamarind chutney',
  'sweet-sour tamarind chutney',
  'swiss cheese',
  'szechuan sauce',
  'tahini sauce',
  'tamarind chutney',
  'tamarind prawns',
  'tamarind sauce',
  'tamas pinot grigio, monterey',
  'tangy red curry',
  'tanqueray gin',
  'tapioca pudding',
  'tarragon aioli',
  'tea flavored',
  'thai chiles',
  'thai coffee',
  'tiger prawns',
  'tomato relish',
  'tonic water',
  'tri-tip steak',
  'triple sec',
  'truffle oil',
  'trumpet mushrooms',
  'tsing tao',
  'tuna-masa roll',
  'turnip cake',
  'turnip cakes',
  'unleavened flat bread',
  'vegetarian curry',
  'vegetarian dal',
  'vegetarian dessert',
  'vegetarian imperial roll',
  'vegetarianetarian imperial rolls',
  'vegetarianetarian sauce',
  'veggie burger',
  'vinaigrette dressing',
  'walnut baguette',
  'walnut roll',
  'warm goat cheese cheese',
  'water chestnuts',
  'watermelon radish',
  'wheat bread',
  'whipped cream',
  'white fungus',
  'white truffle oil',
  'white wine',
  'whole grain',
  'wide rice noodles',
  'wild caught fish',
  'wild mushroom',
  'winter melon',
  'wonton soup',
  'wood bridge cabernet sauvignon',
  'wood ear mushroom',
  'yard long beans',
  'yellow curry',
  'yellow curry sauce',
  'yellow onion',
  'yellow squash',
  'yokaichi soju',
  'york roll',
  'yorkville cellars malbec',
  'young coconut',
  'young peppercorn',
  'yukon potatoes',
  '‘panang’ curry',
  '‘roti\' bread',
  '‘sriracha’ chili' ]
